{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Mobile-first prompt-based creation builder dApp for ICP with saved-item library and share links, expanding exports toward immediately usable deliverables (APK and/or single-file HTML) and improving prompt-to-output fidelity (especially game generation matching the user’s prompt, e.g., space shooter) plus consistent light-mode UI.",
  "existing_features": [
    {
      "id": "IF-1",
      "title": "Role-based access control (RBAC) with admin bootstrap token",
      "synonyms": [
        "AccessControl",
        "RBAC",
        "Admin bootstrap"
      ],
      "description": "Motoko backend maintains per-principal roles (#admin/#user/#guest). Initialization registers a principal on first use; the first principal providing a matching secret (compared to CAFFEINE_ADMIN_TOKEN) becomes admin, others become users. Exposes APIs to query caller role, check admin status, and assign roles (admin-only).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-2",
      "title": "User profile persistence (get/save)",
      "synonyms": [
        "Profile management",
        "Display name"
      ],
      "description": "Backend stores a UserProfile (currently {name}) keyed by principal. Frontend can query the caller’s profile and save updates via React Query hooks with cache invalidation and user-friendly error handling.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-3",
      "title": "Item (creation) persistence with ownership enforcement",
      "synonyms": [
        "Creation storage",
        "Item CRUD"
      ],
      "description": "Backend stores items (id, content JSON string, owner principal, isShared). Authenticated users can create items, fetch an item they own (or that is shared), update items they own, and delete items they own.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-4",
      "title": "User library listing with admin-gated cross-user access",
      "synonyms": [
        "List items",
        "My Creations backend API"
      ],
      "description": "Backend supports listUserItems(user) for authenticated callers; callers can list their own items, and admins can list items for other principals. Frontend consumes this via a React Query hook keyed by principal.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-5",
      "title": "Share/unshare creations and public shared access",
      "synonyms": [
        "Share links",
        "Public viewer"
      ],
      "description": "Owners can toggle isShared on items via shareItem/unshareItem. Shared items can be fetched through getSharedItem without authentication and rendered in a public shared viewer route.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-6",
      "title": "Internet Identity authentication provider",
      "synonyms": [
        "AuthClient integration",
        "II login/logout"
      ],
      "description": "Frontend integrates DFINITY Internet Identity with a provider/hook offering login, logout, persisted session restoration, and detailed status flags (initializing/logging-in/success/error).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-7",
      "title": "Actor creation per identity with access-control initialization",
      "synonyms": [
        "useActor",
        "Actor factory"
      ],
      "description": "Frontend creates an anonymous actor when unauthenticated and an identity-backed actor when authenticated. On authenticated actor creation it calls _initializeAccessControlWithSecret using a secret read from URL hash/sessionStorage. Actor changes trigger invalidation/refetch of non-actor React Query data.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-8",
      "title": "React Query hooks for backend operations",
      "synonyms": [
        "Query hooks",
        "Mutation hooks"
      ],
      "description": "Centralized hooks implement get/save caller profile, create/list/get/getShared item queries, and delete/share/unshare mutations with consistent query keys, conditional enablement based on actor availability, cache invalidation, and graceful handling of authorization errors (return null/[]).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-9",
      "title": "Current user aggregation hook",
      "synonyms": [
        "useCurrentUser",
        "Auth state"
      ],
      "description": "Combines Internet Identity state with the caller profile query to provide isAuthenticated, principal, display name, and unified loading/fetched flags for UI components.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-10",
      "title": "Route protection and first-time profile onboarding",
      "synonyms": [
        "RequireAuth",
        "ProfileSetupModal"
      ],
      "description": "Protected routes are wrapped with an auth guard that prompts login when unauthenticated. After authentication, if the backend profile is missing, a blocking modal collects and saves a display name with retryable error UI.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-11",
      "title": "Mobile-first application shell with navigation and error boundary",
      "synonyms": [
        "AppShell",
        "Bottom navigation"
      ],
      "description": "App-wide layout provides a sticky header (logo + login button), bottom navigation (Builder/My Creations), forced light color-scheme, and a global ErrorBoundary fallback UI with recovery actions.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-12",
      "title": "Builder flow: prompt + type selection + generate + preview + save",
      "synonyms": [
        "BuilderPage",
        "Creation builder UI"
      ],
      "description": "Users select a creation type, enter a prompt, generate deterministic content, preview it via runtime components, and save the creation to the canister when authenticated. Generation and save include retryable error states.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-13",
      "title": "Deterministic, prompt-based creation generation",
      "synonyms": [
        "Template generator",
        "Mock AI generation"
      ],
      "description": "Template-based generator maps prompt keywords to structured data for apps, websites, chatbots, images, and games. Includes simulated latency and returns data suitable for interactive runtime previews and exports.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-14",
      "title": "Creation preview dispatcher",
      "synonyms": [
        "CreationPreview",
        "Runtime switch"
      ],
      "description": "Single component selects the correct runtime renderer for app/website/chatbot/image/game and renders an interactive preview from generated or loaded data.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-15",
      "title": "App runtime: task-list preview",
      "synonyms": [
        "Todo runtime",
        "Task list UI"
      ],
      "description": "Default app runtime renders a task list with completion toggles and optional action buttons using local React state for interactivity.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-16",
      "title": "App runtime: calculator preview (basic + scientific) with safe evaluation",
      "synonyms": [
        "CalculatorRuntime",
        "Scientific calculator"
      ],
      "description": "Calculator runtime supports basic operations and a scientific mode (trig/log/ln/sqrt/power/constants/parentheses). Scientific evaluation uses safeMathEval (tokenization + shunting-yard/RPN) instead of eval/Function, and surfaces readable error states.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-17",
      "title": "Website runtime: multi-page preview with navigation",
      "synonyms": [
        "Website preview",
        "Page tabs"
      ],
      "description": "Website runtime renders pages with navigation buttons and displays the selected page’s title/content and optional image placeholder.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-18",
      "title": "Chatbot runtime: interactive chat UI with scripted responses",
      "synonyms": [
        "Chat preview",
        "Conversation UI"
      ],
      "description": "Chatbot runtime maintains message history, accepts user input, and returns delayed bot responses from provided response arrays (or defaults).",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-19",
      "title": "Image runtime: image display with fallback placeholder",
      "synonyms": [
        "Image preview",
        "Emoji placeholder"
      ],
      "description": "Image runtime displays a provided image URL or a styled fallback placeholder (emoji + description) with optional caption.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-20",
      "title": "Game template system (keyword-based) and schema normalization",
      "synonyms": [
        "Game templates",
        "normalizeGameData"
      ],
      "description": "Prompt keywords deterministically select a game template (runner/shooter/catch/puzzle/space) including theme colors, settings, HUD labels, and progression. normalizeGameData validates/fills defaults to keep previews/exports stable with partial input.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-21",
      "title": "In-app 2D canvas game runtime with overlays and progression",
      "synonyms": [
        "GameRuntime2D",
        "Canvas game preview"
      ],
      "description": "Canvas mini-game with start/pause/gameover overlays, HUD updates, keyboard + pointer/touch controls, target spawning, collisions, health/score tracking, and level-based difficulty progression. Re-normalizes game config and resets runtime when input data changes.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-22",
      "title": "Responsive canvas sizing and pointer mapping (HiDPI)",
      "synonyms": [
        "useCanvasFit",
        "DPR scaling"
      ],
      "description": "Custom hook fits canvas to container with fixed aspect ratio, applies devicePixelRatio scaling (resetting transforms to avoid compounding), and maps pointer coordinates into canvas space.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-23",
      "title": "Creations library UI (list/open/share/delete/download)",
      "synonyms": [
        "MyCreationsPage",
        "CreationListItem"
      ],
      "description": "Authenticated library page lists the user’s saved items with actions to open, share/unshare (and show/copy share URL), download exports (HTML/JSON/Android guide for app creations), and delete with confirmation; includes empty/loading/error states.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-24",
      "title": "Owned creation viewer with management actions",
      "synonyms": [
        "CreationViewerPage",
        "ViewerHeaderActions"
      ],
      "description": "Dedicated route fetches a saved item by id, parses its JSON content, renders the interactive preview, and provides download/share/unshare/delete actions with defensive error handling.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-25",
      "title": "Public shared viewer route (read-only)",
      "synonyms": [
        "SharedViewerPage",
        "Shared link view"
      ],
      "description": "Unauthenticated route fetches shared items by id and renders the preview with not-found and parse-error recovery states.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-26",
      "title": "Downloaded JSON viewer (in-app reopen)",
      "synonyms": [
        "DownloadedCreationViewerPage",
        "sessionStorage reopen"
      ],
      "description": "JSON exports are saved to sessionStorage and can be reopened inside the app via a dedicated viewer route, with error UI for missing/corrupt stored data.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-27",
      "title": "Client-side export/download system (JSON, HTML, Android guide)",
      "synonyms": [
        "downloadCreation",
        "Export formats"
      ],
      "description": "Exports creations as: (1) JSON download with sessionStorage persistence, (2) standalone single-file HTML with inline CSS/JS per type (including embedded game runtime), and (3) Android WebView setup instructions text export (limited to app creations). Includes post-download dialogs and Android-specific help UI.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-28",
      "title": "Exported game runtime for HTML export",
      "synonyms": [
        "exportedGameRuntime",
        "Playable HTML game"
      ],
      "description": "HTML export for games includes generated styles and an inline JavaScript runtime implementing overlays, input handling, spawning/collisions, HUD updates, and progression using normalized GameData.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-29",
      "title": "Share link utilities (generate + copy)",
      "synonyms": [
        "shareLinks",
        "Clipboard copy"
      ],
      "description": "Utilities build hash-based share URLs for public viewing and copy them to the clipboard using navigator.clipboard with a textarea/execCommand fallback.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "IF-30",
      "title": "Centralized async error UI and error message normalization",
      "synonyms": [
        "AsyncState",
        "normalizeError"
      ],
      "description": "Reusable AsyncState component displays standardized retryable error alerts. normalizeError converts backend traps, authorization failures, network issues, parsing issues, download/export problems, and clipboard errors into user-friendly strings.",
      "reqIds": [],
      "version": 1
    },
    {
      "id": "feature-improve-game-prompt-intent-detection-so-that-when-the-user-selects-creation-type-game-the-generated-gamekind-reliably-matches-the-user-s-prompt-specifically-ensuring-that-prompts-like-space-shooter-produce-a-shooter-style-game-rather-than-a-different-template",
      "title": "Improve game prompt intent detection so that when the user selects Creation Type = Game, the generated gameKind reliably matches the user’s prompt (specifically ensuring that prompts like “space shooter” produce a shooter-style game rather than a different template).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-user-visible-explanation-in-the-game-generation-flow-that-shows-what-game-kind-was-detected-from-the-prompt-e-g-detected-shooter-and-provide-an-explicit-manual-override-control-to-select-the-desired-game-kind-before-generating-so-the-user-can-force-shooter-even-if-detection-fails",
      "title": "Add a user-visible explanation in the Game generation flow that shows what game kind was detected from the prompt (e.g., “Detected: Shooter”), and provide an explicit manual override control to select the desired game kind before generating (so the user can force “Shooter” even if detection fails).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Implement real Android APK export/download for created items (not a placeholder guide), so users can immediately install/use after download.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Allow created items to be downloaded in either APK or standalone single-file HTML format for immediate use after download.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Support saving created/downloaded items into device storage and optionally auto-open the item after download completes.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Ensure the entire app uses a consistent light-mode theme (including dashboard) with no dark UI surfaces.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Fix game creator so the generated game matches the user’s prompt intent (e.g., 'space shooter' should produce a space shooter), and improve generated games to look/feel professional (starter templates/polish).",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "architectural_notes": [
    "Frontend is a React + TypeScript SPA using TanStack Router for routing and TanStack React Query for data fetching/mutations, conditional query enablement, and cache invalidation.",
    "Authentication uses DFINITY AuthClient (Internet Identity) wrapped in a React context/provider (InternetIdentityProvider) with detailed login status flags and persisted sessions.",
    "Backend is a Motoko canister that stores per-principal user profiles and items, protected by an AccessControl module (RBAC) included via a mixin (MixinAuthorization).",
    "Frontend creates a canister actor through a dedicated hook (useActor) keyed by the current principal; on actor creation/identity changes it invalidates/refetches dependent React Query caches.",
    "Creation “generation” is deterministic and template-based (no external AI calls): prompt keyword heuristics produce structured data for each creation type.",
    "Sharing is implemented as a server-side isShared flag; public read-only access uses a dedicated canister query (getSharedItem) and a public route in the SPA.",
    "Export/download is entirely client-side: JSON download + sessionStorage persistence, HTML single-file export with embedded runtime scripts/styles, and Android export as a text setup guide.",
    "UI uses Tailwind + shadcn/ui components, a mobile-first app shell (sticky header + bottom nav), and a global ErrorBoundary for render-time failure isolation."
  ],
  "known_issues": [
    "Android export is not a real Android project ZIP/APK; exportAndroidProjectZip currently returns a plain-text setup guide (placeholder implementation).",
    "Backend authorization bootstrap depends on the CAFFEINE_ADMIN_TOKEN environment variable; if it is unset, _initializeAccessControlWithSecret traps, which can break authenticated flows because the frontend calls this during actor creation.",
    "AccessControl.getUserRole traps for non-anonymous principals that have not been registered via initialization; this can surface as canister traps rather than clean authorization errors.",
    "HTML export calculator runtime uses eval() to evaluate expressions, which is riskier than the in-app safeMathEval approach (tokenization/RPN).",
    "exportCreationToHtml.escapeHtml relies on document.createElement, making HTML export generation browser/DOM-dependent (would fail in non-DOM contexts such as SSR or some workers).",
    "There are two CSS token files (frontend/index.css and frontend/src/index.css). The app imports src/index.css, but if build tooling includes both, variable/token conflicts are possible.",
    "Backend getItem does not grant admins access to other users’ private (non-shared) items (admin bypass exists for listUserItems and role assignment, but not for reading arbitrary private items).",
    "Game generation can fail to match the user’s prompt intent (e.g., 'space shooter' prompt produces a different game template).",
    "Light-mode request not consistently applied: dashboard can appear dark/unreadable for users expecting full light theme."
  ],
  "isFixRequest": true,
  "generatedImages": [],
  "gameProjectType": "none",
  "projectName": "Mobile-first prompt-based AI app builder with saved items library (open/download/share/delete)",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}